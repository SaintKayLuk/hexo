---
title: Docker入门
date: 2019-07-30 16:40:54
tags: 
    - docker
categories: 
    - docker
---
# Docker概念
Docker是开发人员和系统管理员 使用容器开发，部署和运行应用程序的平台。使用Linux容器部署应用程序称为容器化。容器不是新的，但它们用于轻松部署应用程序。

<!-- more -->

![](/images/docker/docker概念.png)


容器化越来越受欢迎，因为容器是：

* 灵活：即使是最复杂的应用也可以集装箱化。
* 轻量级：容器利用并共享主机内核。
* 可互换：您可以即时部署更新和升级。
* 便携式：您可以在本地构建，部署到云，并在任何地方运行。
* 可扩展：您可以增加并自动分发容器副本。
* 可堆叠：您可以垂直和即时堆叠服务。



## 镜像和容器

通过运行镜像启动容器。一个镜像是一个可执行的包，其中包括运行应用程序所需的所有内容(代码，运行时，库，环境变量，和配置文件)。

容器是镜像的运行时实例，您可以使用该命令查看正在运行的容器列表docker ps，就像在Linux中一样。
有个经典的例子，来描述镜像和容器的关系
``` 
class Person{
    ...
}
Person p =new Person();
```

镜像就相当于我们的类，是只读的，而容器就好比我们实例化出来的对象，可读写。

## 容器和虚拟机

我们简单理解下，docker其实就是一个平台，最主要的是一个容器的概念，那何为容器，我们来举个例子。
* 物理机： 相当于我们的一台电脑，一堆硬件的组合，硬盘，内存，cpu等组成的一台机器，一台电脑就是一个物理机。在这台机器上装一个操作系统，比如centos，那我们就可以在上面跑我们的程序了
* 虚拟机： 相对于物理机而言，是虚拟化的，不是实体，虚拟机就是在我们原有的物理机上面装多个操作系统，但是所用的资源cpu，内存等都是从物理机借的。
* 容器： 容器也是虚拟的，但是和虚拟机不一样的是，他不是一整套操作系统，他是直接运行在linux内核上面，虚拟出一个环境。

我们通俗的理解一下，我们的物理机就相当于你有一块地皮，在这块地上面盖了3层洋房，这幢房子就相当于物理机，里面有客厅，厨房，卫生间等，就相当于我们的内存，cpu等，各司其职。虚拟机就相当于开发商盖的一幢商品房，一幢房子是一个物理机，但是这幢房子里面有很多户房。每一户就相当于一个虚拟机，里面的厨房，卫生间等都是私有的。那我们的容器就更厉害了，相当于我们现在的胶囊旅馆，在私有空间里面互不影响，但是厨房，卫生间等都是公用的，相当于是用物理机的cpu，内存等。我们来张图，更能体现容器为什么比虚拟机占用更少的资源

![](/images/docker/container-vm.png)

一个容器中运行原生Linux和共享主机与其它容器的内核。它运行一个独立的进程，不占用任何其他可执行文件的内存，使其轻量级。
相比之下，虚拟机（VM）运行一个完整的“客户”操作系统，通过虚拟机管理程序对主机资源进行虚拟访问。通常，VM提供的环境比大多数应用程序需要的资源更多。



关于docker如何安装，可以看这篇文章[Docker安装](/2019/07/31/Docker安装)


下面我们的重头戏...

# Docker三大核心 (容器-镜像-仓库)

我们先来上一张图
![](/images/docker/docker.png)

这张图很好的描述了容器，镜像，仓库之间的关系。
我们先说一下这三者的关系，容器上面已经说了，就是一个运行的实例，我们的程序都运行在容器中，镜像就是包含运行程序的一整套环境，而仓库更好理解，就是存放镜像的。用过maven的都知道，maven有个中央仓库，用来存放程序包，docker也有一个这样的仓库 [docker-hub](https://hub.docker.com/)
因为仓库在国外，下载速度慢的话，我们可以去docker的配置文件修改

```
$ /etc/docker/deamon.json
```

从图中可以看出，我们有个Dockerfile文件，这是一个构建文件，通过docker build可以根据指定的Dockerfile构建出一个镜像

查看本地的镜像
~~~
$ docker images
~~~

删除本地镜像
~~~
$ docker rmi 镜像名/镜像id
~~~

查看镜像或者容器信息
~~~
$ docker inspect 镜像id/容器id
~~~

从仓库下载镜像(默认从docker-hub下载) tag是版本号，不写时为缺省,我们以下载nginx为例
~~~
$ docker pull nginx:1.7
~~~

创建我们刚刚下载的nginx容器
~~~
$ docker run -p 80:80  -d nginx:1.17
~~~
-p 80:80 指我们用容器的80端口映射到宿主机的80端口，-d代表启动一个守护进程， 后面nginx:1.17则是我们刚刚下载的镜像
![](/images/2019-07-30-Docker入门/nginx.png)

查看,运行，停止，删除(只有不在运行中的容器才能删除)容器
~~~
$ docker ps
$ docker start 容器名/容器id
$ docker stop 容器名/容器id
$ docker rm 容器名/容器id
~~~


